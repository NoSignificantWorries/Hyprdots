(defvar revealer-state false)
(defvar apps-spacing 6)
(defvar apps-icon-size 40)
(defvar apps-slide-time 300)

(defwidget app-button [icon-path command]
    (button :style "background-image: url('${icon-path}');" :class "app-btn" :width {apps-icon-size} :height {apps-icon-size} :onclick command "")
)

(defwidget apps-row []
    (box
        :class "main-apps"
        :orientation "h" :spacing {apps-spacing} :space-evenly false :hexpand false :vexpand false :halign "center" :valign "center"
        (app-button :icon-path "/home/dmitry/.icons/desktop/deepseek-logo-icon.svg" :command "notify-send 'Test' 'AAA'")
        (app-button :icon-path "/home/dmitry/.icons/desktop/deepseek-logo-icon.svg" :command "notify-send 'Test' 'AAA'")
        (app-button :icon-path "/home/dmitry/.icons/desktop/deepseek-logo-icon.svg" :command "notify-send 'Test' 'AAA'")
        (app-button :icon-path "/home/dmitry/.icons/desktop/deepseek-logo-icon.svg" :command "notify-send 'Test' 'AAA'")
        (app-button :icon-path "/home/dmitry/.icons/desktop/deepseek-logo-icon.svg" :command "notify-send 'Test' 'AAA'")
    )
)

(defwidget apps-list []
    (box
        :class "add-apps"
        :orientation "v" :spacing {apps-spacing} :space-evenly false :hexpand false :vexpand false :halign "center" :valign "center"
        (box
            :orientation "h" :spacing {apps-spacing} :space-evenly false :hexpand false :vexpand false :halign "fill" :valign "center"
            (app-button :icon-path "/home/dmitry/.icons/desktop/deepseek-logo-icon.svg" :command "notify-send 'Test' 'AAA'")
            (app-button :icon-path "/home/dmitry/.icons/desktop/deepseek-logo-icon.svg" :command "notify-send 'Test' 'AAA'")
            (app-button :icon-path "/home/dmitry/.icons/desktop/deepseek-logo-icon.svg" :command "notify-send 'Test' 'AAA'")
            (app-button :icon-path "/home/dmitry/.icons/desktop/deepseek-logo-icon.svg" :command "notify-send 'Test' 'AAA'")
            (app-button :icon-path "/home/dmitry/.icons/desktop/deepseek-logo-icon.svg" :command "notify-send 'Test' 'AAA'")
        )
        (box
            :orientation "h" :spacing {apps-spacing} :space-evenly false :hexpand false :vexpand false :halign "fill" :valign "center"
            (app-button :icon-path "/home/dmitry/.icons/desktop/deepseek-logo-icon.svg" :command "notify-send 'Test' 'AAA'")
            (app-button :icon-path "/home/dmitry/.icons/desktop/deepseek-logo-icon.svg" :command "notify-send 'Test' 'AAA'")
            (app-button :icon-path "/home/dmitry/.icons/desktop/deepseek-logo-icon.svg" :command "notify-send 'Test' 'AAA'")
        )
    )
)

(defwidget applications []
    (box
        :space-evenly false :hexpand false :vexpand false :halign "center" :valign "center"
        (eventbox
            :onhover "eww update -c ~/.config/eww/widgets/bar revealer-state=true"
            :onhoverlost "eww update -c ~/.config/eww/widgets/bar revealer-state=false"
            (box
                :orientation "v"
                :space-evenly false :hexpand false :vexpand false :halign "center" :valign "center"
                (apps-row)
                (revealer
                    :transition "slidedown"
                    :duration {apps-slide-time}
                    :reveal {revealer-state}
                    (apps-list)
                )
            )
        )
    )
)

(defwidget workspaces []
    (box
        :class "workspaces"
    )
)

(defwidget my-systray []
    (box
        :class "systray"
        (systray)
    )
)

(defwindow workspaces-window
    :monitor 0
    :hexpand false
    :vexpand false
    :windowtype "dock"
    :namespace "bar"
    :stacking "fg"
    :geometry (geometry
        :anchor "top left"
        :x "0%"
        :y "-55px"
        :width 300
        :height 55)
    (workspaces)
)

(defwindow systray-window
    :monitor 0
    :hexpand false
    :vexpand false
    :windowtype "dock"
    :namespace "bar"
    :stacking "fg"
    :geometry (geometry
        :anchor "top left"
        :x "310px"
        :y "-55px"
        :width 300
        :height 55)
    (my-systray)
)

(defwindow applications-window
    :monitor 0
    :hexpand false
    :vexpand false
    :windowtype "dock"
    :namespace "bar"
    :stacking "fg"
    :geometry (geometry
        :anchor "top center"
        :x "0%"
        :y "-55px"
        :width 300
        :height 55)
    (box
        :orientation "v"
        (applications)
    )
)

(defwindow reserver
    :exclusive true
    :monitor 0
    :namespace "bar"
    :stacking "bg"
    :focusable false
    :geometry (geometry
        :x "0%"
        :y "0%"
        :width "100%"
        :height "60px"
        :anchor "top center")
    :reserve (struts :side "top" :distance "60")
    (box
        :class "reserver"
        :orientation "h"
    )
)

